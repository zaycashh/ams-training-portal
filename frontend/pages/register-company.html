<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Company Account | AMS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../css/main.css" />
</head>
<body>

<main class="auth-container">
  <div class="auth-card">

    <div class="back-link">
      <a href="register-select.html">‚Üê Back to Registration Options</a>
    </div>

    <h2>Create Company Account</h2>
    <p>This account is for company administrators who manage employee seats.</p>

    <form id="companyRegisterForm" class="auth-form">

      <div class="form-row">
        <label>First Name</label>
        <input type="text" id="firstName" required />
      </div>

      <div class="form-row">
        <label>Last Name</label>
        <input type="text" id="lastName" required />
      </div>

      <div class="form-row">
        <label>Company Name</label>
        <input type="text" id="companyName" required />
      </div>

      <div class="form-row">
        <label>Phone Number</label>
        <input type="tel" id="phone" required />
      </div>

      <div class="form-row">
        <label>Email Address</label>
        <input type="email" id="email" required />
      </div>

      <div class="form-row">
        <label>Password</label>
        <input type="password" id="password" required />
      </div>

      <div class="form-row">
        <label>Confirm Password</label>
        <input type="password" id="confirmPassword" required />
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary">
          Create Company Account
        </button>
      </div>

      <p style="margin-top:14px; text-align:center;">
        Already have an account?
        <a href="login.html">Login</a>
      </p>

    </form>

  </div>
</main>

<script>
document.getElementById("companyRegisterForm")
.addEventListener("submit", function (e) {

  e.preventDefault();

  const firstName = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const companyName = document.getElementById("companyName").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const email = document.getElementById("email").value.trim().toLowerCase();
  const password = document.getElementById("password").value;
  const confirmPassword = document.getElementById("confirmPassword").value;

  if (!firstName || !lastName || !companyName || !phone || !email || !password || !confirmPassword) {
    alert("Please complete all fields.");
    return;
  }

  if (password !== confirmPassword) {
    alert("Passwords do not match.");
    return;
  }

  const users = JSON.parse(localStorage.getItem("ams_users") || "[]");

  // üîí Prevent duplicate email accounts
  const existingUser = users.find(u => u.email === email);
  if (existingUser) {
    alert("An account with this email already exists.");
    return;
  }

  const companyId = "comp-" + Date.now();

  const companyProfile = {
    id: companyId,
    name: companyName,
    createdAt: Date.now(),
    seats: {
      employee: {
        total: 5,
        used: 0
      }
    },
    usedSeats: {},
    invites: {},
    modules: [],
    employees: {}
  };

  localStorage.setItem("companyProfile", JSON.stringify(companyProfile));

  const companyAdminUser = {
    id: "admin-" + email,
    firstName,
    lastName,
    company: companyName,
    phone,
    email,
    role: "company_admin",
    type: "company",
    companyId,
    createdAt: Date.now()
  };

  // ‚úÖ Save to user database
  users.push(companyAdminUser);
  localStorage.setItem("ams_users", JSON.stringify(users));

  // ‚úÖ Start session
  localStorage.setItem("amsUser", JSON.stringify(companyAdminUser));

  window.location.replace("company-dashboard.html");
});
</script>

</body>
</html>
