<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Employee Training | AMS Training Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../css/main.css" />
</head>

<body data-module="employee">

<script>
/* ======================================================
   EMPLOYEE ROUTE GUARD (FIXED ‚Äî SEAT SYSTEM SYNCED)
====================================================== */
(function () {
  const user = JSON.parse(localStorage.getItem("amsUser") || "null");

  // üîê Must be logged in
  if (!user) {
    window.location.replace("login.html");
    return;
  }

  // üîí Allow if employee OR has assigned company seat
const company = JSON.parse(
  localStorage.getItem("companyProfile") || "null"
);

const seatAssigned = company?.usedSeats?.[user?.id];

if (user.role !== "employee" && !seatAssigned) {
  sessionStorage.setItem(
    "ams_notice",
    "This training is only available to employees."
  );
  window.location.replace("dashboard.html");
  return;
}
  // üí≥ Must have purchase OR assigned company seat
  const hasPurchase =
    localStorage.getItem("paid_employee") === "true";

  const company = JSON.parse(
    localStorage.getItem("companyProfile") || "null"
  );

  const seatAssigned = company?.usedSeats?.[user?.id];

  if (!hasPurchase && !seatAssigned) {
    sessionStorage.setItem(
      "ams_notice",
      "You must use a company seat or purchase this training."
    );
    window.location.replace("dashboard.html");
    return;
  }
})();
</script>

<main class="module-container">

  <!-- HEADER -->
  <header class="module-header">
    <h1 data-lang="title">Employee Training Module</h1>

    <div class="module-controls">
      <select id="languageToggle">
        <option value="en">English</option>
        <option value="es">Espa√±ol</option>
      </select>

      <button class="btn-secondary" onclick="goDashboard()">
        Back to Dashboard
      </button>
    </div>
  </header>

  <!-- NAV -->
  <nav class="module-nav">
    <button id="btnContent" onclick="showSection('content')">Content</button>
    <button id="btnQuiz" onclick="showSection('quiz')">Quiz</button>
    <button id="btnCertificate" onclick="showSection('certificate')">Certificate</button>
  </nav>

  <!-- CONTENT -->
  <section id="contentSection" class="module-section">
    <h2>Employee Training Content</h2>
    <p>This training provides drug and alcohol awareness for employees.</p>

    <button class="btn-primary" id="continueToQuizBtn">
      Continue to Quiz
    </button>
  </section>

  <!-- QUIZ -->
  <section id="quizSection" class="module-section hidden">
    <h2>Employee Quiz</h2>
    <p>Complete the quiz to finish the training.</p>

    <div id="quizContainer"></div>
  </section>

  <!-- CERTIFICATE -->
  <section id="certificateSection" class="module-section hidden">
    <h2>Training Certificate</h2>

    <p>
      This certifies that
      <strong id="certName">Employee Name</strong>
      has successfully completed Employee Training.
    </p>

    <p>Date Issued: <span id="certDate"></span></p>
    <p>Verification Code: <span id="certVerify"></span></p>

    <div id="certQR" style="margin-top:16px;"></div>

    <button class="btn-primary" onclick="goDashboard()">
      Return to Dashboard
    </button>
  </section>

</main>

<!-- CORE GUARDS -->
<script src="../js/route-guard.js"></script>
<script src="../js/access-guard.js"></script>

<!-- LANGUAGE -->
<script src="../js/lang-loader.js"></script>

<!-- PROGRESS SYSTEM -->
<script src="../js/progress.js"></script>

<!-- CORE ENGINE -->
<script src="../js/core.js"></script>

<!-- QR LIBRARY -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<!-- EMPLOYEE MODULE -->
<script src="../js/employee.js"></script>

</body>
</html>
