<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FMCSA – Reasonable Suspicion Training</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="../css/main.css" />
</head>
<body>

<main class="module-container">

  <!-- HEADER -->
  <header class="module-header">
    <h1>Supervisor Reasonable Suspicion Awareness Training</h1>

    <button class="btn-secondary" onclick="goBack()">Back to FMCSA</button>
  </header>

  <!-- INFO -->
  <section class="module-section">
    <p>
      This training must be completed within <strong>30 days</strong> of purchase.
      You must review all content before taking the quiz.
    </p>
  </section>

  <!-- CONTENT SECTION -->
  <section class="module-section" id="contentSection">
    <h2>Training Content</h2>

    <!-- Replace these with slideshow embeds later -->
    <div class="content-block">
      <p>✔ Signs & symptoms of drug use</p>
      <p>✔ Behavioral indicators</p>
      <p>✔ Physical indicators</p>
      <p>✔ Documentation requirements</p>
      <p>✔ Supervisor responsibilities</p>
    </div>

    <button class="btn-primary" onclick="markContentComplete()">
      I Have Completed the Training Content
    </button>
  </section>

  <!-- QUIZ LOCKED -->
  <section class="module-section hidden" id="quizUnlockSection">
    <h2>Quiz Unlocked</h2>

    <p>You may now begin the quiz. A score of <strong>80%</strong> is required to pass.</p>

    <button class="btn-primary" onclick="startQuiz()">
      Start Quiz
    </button>
  </section>

</main>

<script>

/* ==========================
   AUTH + PAYMENT GUARD
========================== */
(function () {

  const user = localStorage.getItem("amsUser");

  if (!user) {
    window.location.replace("../login.html");
    return;
  }

  const paid = localStorage.getItem("paid_fmcsa");
  if (paid !== "true") {
    alert("FMCSA training is locked. Please purchase from dashboard.");
    window.location.replace("../dashboard.html");
    return;
  }

  const startDate = localStorage.getItem("fmcsa_start_date");

  if (!startDate) {
    window.location.replace("../dashboard.html");
    return;
  }

  const DAY_MS = 86400000;
  const LIMIT_DAYS = 30;

  if ((Date.now() - Number(startDate)) > LIMIT_DAYS * DAY_MS) {
    alert("Your 30-day training window has expired.");
    localStorage.removeItem("paid_fmcsa");
    window.location.replace("../dashboard.html");
    return;
  }

})();

/* ===========================
   NAVIGATION
=========================== */
function goBack() {
  window.location.href = "../dashboard.html";
}

/* ===========================
   CONTENT COMPLETION
=========================== */
function markContentComplete() {
  localStorage.setItem("fmcsa_mod1_content_done", "true");

  document.getElementById("quizUnlockSection").classList.remove("hidden");
  alert("Content completed. Quiz unlocked.");
}

/* ===========================
   START QUIZ (NEXT STEP)
=========================== */
function startQuiz() {

  const passed = confirm(
    "Simulate passing the quiz?\n\n(Real quiz engine coming next.)"
  );

  if (!passed) return;

  // ✅ Mark Module A Complete
  localStorage.setItem("fmcsaModuleACompleted", "true");

  // Optional: mark quiz passed if you want tracking
  localStorage.setItem("fmcsa_mod1_quiz_passed", "true");

  // ✅ Redirect to Drug & Alcohol Module
  window.location.href = "dashboard.html";
}

</script>

</body>
</html>
