<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FMCSA Drug & Alcohol Substance Abuse Training | AMS Training Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../css/main.css" />
</head>

<body data-module="fmcsa-drug-alcohol">
<script>
(function () {

  const user = JSON.parse(localStorage.getItem("amsUser") || "null");

  if (!user) {
    window.location.replace("../login.html");
    return;
  }

  // üîí Block employees
  if (user.role === "employee") {
    alert("Unauthorized access.");
    window.location.replace("../dashboard.html");
    return;
  }

  // üîí Must purchase FMCSA
  if (localStorage.getItem("paid_fmcsa") !== "true") {
    alert("FMCSA Training requires purchase.");
    window.location.replace("../dashboard.html");
    return;
  }

  // üîí Expiration enforcement
  const start = localStorage.getItem("fmcsa_start_date");

  if (start) {
    const DAY_MS = 86400000;
    const LIMIT_DAYS = 30;

    const elapsed = Date.now() - Number(start);
    const daysUsed = Math.floor(elapsed / DAY_MS);

    if (daysUsed >= LIMIT_DAYS) {
      alert("FMCSA training window expired. Repurchase required.");
      window.location.replace("../dashboard.html");
      return;
    }
  }

})();
</script>
  
<main class="module-container">

  <header class="module-header">
    <h1>FMCSA Drug & Alcohol Substance Abuse Training</h1>
    <button class="btn-secondary" onclick="logout()">Log Out</button>
  </header>

  <!-- ========================
       DRUG CONTENT
  ========================= -->
  <section id="drugContentSection" class="module-section">
    <h2>Drug Awareness Training Content</h2>

    <div class="pdf-viewer">
      <canvas id="drugPdfCanvas"></canvas>

      <div class="pdf-controls">
        <button id="drugPrevPageBtn" class="btn-secondary">‚Üê Previous</button>

        <span>
          Page <span id="drugCurrentPage">1</span>
          of <span id="drugTotalPages">--</span>
        </span>

        <button id="drugNextPageBtn" class="btn-secondary">Next ‚Üí</button>
      </div>

      <div class="progress-wrapper">
        <div id="drugProgressBar"></div>
      </div>
    </div>

    <button
      id="completeDrugContentBtn"
      class="btn-primary"
      disabled
    >
      I Have Completed Drug Awareness Training Content
    </button>
  </section>

  <!-- ========================
       DRUG QUIZ
  ========================= -->
  <section id="drugQuizSection" class="module-section hidden">
    <h2>Drug Quiz</h2>

    <div class="quiz-container">
      <div id="drugQuizQuestions"></div>

      <div class="quiz-nav">
        <button id="drugPrevBtn" class="btn-secondary">Previous</button>
        <button id="drugNextBtn" class="btn-primary">Next</button>
      </div>

      <div id="drugQuizResult"></div>
    </div>
  </section>

  <!-- ========================
       ALCOHOL CONTENT
  ========================= -->
  <section id="alcoholContentSection" class="module-section hidden">
    <h2>Alcohol Substance Abuse Training Content</h2>

    <div class="pdf-viewer">
      <canvas id="alcoholPdfCanvas"></canvas>

      <div class="pdf-controls">
        <button id="alcoholPrevPageBtn" class="btn-secondary">‚Üê Previous</button>

        <span>
          Page <span id="alcoholCurrentPage">1</span>
          of <span id="alcoholTotalPages">--</span>
        </span>

        <button id="alcoholNextPageBtn" class="btn-secondary">Next ‚Üí</button>
      </div>

      <div class="progress-wrapper">
        <div id="alcoholProgressBar"></div>
      </div>
    </div>

    <button
      id="completeAlcoholContentBtn"
      class="btn-primary"
      disabled
    >
      I Have Completed Alcohol Substance Abuse Training Content
    </button>
  </section>

  <!-- ========================
       ALCOHOL QUIZ
  ========================= -->
  <section id="alcoholQuizSection" class="module-section hidden">
    <h2>Alcohol Quiz</h2>

    <div class="quiz-container">
      <div id="alcoholQuizQuestions"></div>

      <div class="quiz-nav">
        <button id="alcoholPrevBtn" class="btn-secondary">Previous</button>
        <button id="alcoholNextBtn" class="btn-primary">Next</button>
      </div>

      <div id="alcoholQuizResult"></div>
    </div>
  </section>
  <!-- =========================================================
     MODULE B CERTIFICATE SECTION
========================================================= -->
<section id="moduleBCertificateSection" class="hidden module-section">

  <div class="certificate-card">
    <h2>üéì FMCSA Drug & Alcohol Substance Abuse Training Certificate</h2>

    <p><strong>Name:</strong> <span id="moduleBCertName"></span></p>
    <p><strong>Date Completed:</strong> <span id="moduleBCertDate"></span></p>
    <p><strong>Certificate ID:</strong> <span id="moduleBCertId"></span></p>

    <button class="btn-primary" onclick="returnToDashboard()">
      Return to Dashboard
    </button>
  </div>

</section>

</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="../js/route-guard.js"></script>
<script src="../js/fmcsa-drug-alcohol.js"></script>

</body>
</html>
